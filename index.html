<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>Juego de Memoria Emoji</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="index.css">
</head>
<body class="flex flex-col items-center justify-start min-h-screen px-3 pb-4 select-none">

    <div id="main-menu" class="w-full max-w-md flex flex-col items-center justify-center fade-in text-center mt-10">
        <div class="mb-8">
            <span class="text-7xl animate-bounce inline-block filter drop-shadow-lg mb-2">ğŸ§©</span>
            <h1 class="text-5xl font-bold text-white text-shadow mt-2 drop-shadow-md tracking-tight leading-tight">Memoria<br>Emoji</h1>
            <p class="text-white/90 mt-3 text-xl font-medium">Â¡Supera los 10 niveles!</p>
            
            <p id="connection-status" class="text-white/60 text-xs mt-3 font-mono bg-black/20 px-3 py-1 rounded-full inline-block">Cargando...</p>
            
            <button id="install-btn" class="hidden mt-4 bg-white/20 hover:bg-white/30 text-white px-5 py-2 rounded-full text-base font-bold transition flex items-center gap-2 mx-auto border border-white/30">
                â¬‡ï¸ Instalar App
            </button>
        </div>

        <button onclick="window.gameApp.openModeSelection()" class="menu-btn hover:bg-indigo-50 text-indigo-600 transform transition hover:-translate-y-1 text-xl py-4 shadow-lg w-full">
            â–¶ï¸ Jugar
        </button>
        
        <button onclick="window.gameApp.openRecordsModal()" class="menu-btn hover:bg-pink-50 text-pink-600 transform transition hover:-translate-y-1 text-xl py-4 shadow-lg w-full mt-3">
            ğŸ† RÃ©cords Globales
        </button>
    </div>

    <div id="game-container" class="w-full flex flex-col items-center h-full hidden fade-in max-w-4xl">
        <header class="w-full mb-4 text-white max-w-2xl">
            <div class="flex justify-between items-center mb-3 px-1">
                <button onclick="window.gameApp.confirmExit()" class="text-sm font-bold bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full backdrop-blur-sm transition flex items-center gap-2 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/></svg>
                    MenÃº
                </button>
                <div class="font-bold text-xl drop-shadow-md">Nivel <span id="current-level" class="text-yellow-300 text-3xl ml-1">1</span><span class="opacity-70 text-base">/10</span></div>
            </div>
            
            <div class="flex justify-between items-center bg-white/20 rounded-2xl p-3 backdrop-blur-sm shadow-xl border border-white/20">
                <div class="flex flex-col items-center flex-1 border-r border-white/20 transition-colors duration-300 rounded-l-xl">
                    <span id="left-stat-label" class="text-[10px] uppercase tracking-wider opacity-90 font-bold truncate w-full text-center px-1">Tiempo</span>
                    <span id="left-stat-value" class="text-2xl font-bold font-mono leading-tight drop-shadow-sm">00:00</span>
                </div>
                
                <button onclick="window.gameApp.restartLevel()" class="mx-3 bg-white text-indigo-600 p-3 rounded-full shadow-lg hover:bg-indigo-50 active:scale-90 transition transform hover:rotate-180 duration-500" title="Reiniciar Nivel">
                   <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/></svg>
                </button>

                <div class="flex flex-col items-center flex-1 border-l border-white/20 transition-colors duration-300 rounded-r-xl">
                    <span id="right-stat-label" class="text-[10px] uppercase tracking-wider opacity-90 font-bold truncate w-full text-center px-1">Pares</span>
                    <span id="right-stat-value" class="text-2xl font-bold leading-tight drop-shadow-sm">--</span>
                </div>
            </div>
        </header>

        <div class="flex-grow w-full flex items-start justify-center relative">
            <div id="game-board" class="grid-container"></div>
        </div>
    </div>

    <div id="mode-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal-overlay p-4 fade-in">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl text-center w-full max-w-sm">
            <div class="text-5xl mb-4">ğŸ®</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Elige el modo</h2>
            <div class="space-y-3">
                <button onclick="window.gameApp.startGameSolo()" class="w-full bg-blue-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-600 shadow-md transition transform hover:scale-105">ğŸ‘¤ Solo</button>
                <button onclick="window.gameApp.openNamesModal()" class="w-full bg-purple-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-purple-600 shadow-md transition transform hover:scale-105">âš”ï¸ 1 vs 1</button>
            </div>
            <button onclick="window.gameApp.closeModeSelection()" class="mt-4 text-gray-500 text-sm hover:text-gray-700 underline">Cancelar</button>
        </div>
    </div>

    <div id="names-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal-overlay p-4 fade-in">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl text-center w-full max-w-sm">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Jugadores</h2>
            <div class="space-y-4 text-left">
                <div><label class="text-xs font-bold text-red-500 uppercase ml-1">Jugador 1</label><input type="text" id="p1-input" placeholder="Nombre J1" class="w-full border-2 border-red-100 rounded-lg px-3 py-2 font-bold text-gray-700 focus:border-red-500 outline-none" maxlength="14"></div>
                <div><label class="text-xs font-bold text-green-500 uppercase ml-1">Jugador 2</label><input type="text" id="p2-input" placeholder="Nombre J2" class="w-full border-2 border-green-100 rounded-lg px-3 py-2 font-bold text-gray-700 focus:border-green-500 outline-none" maxlength="14"></div>
            </div>
            <button onclick="window.gameApp.startVersusGame()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold mt-6 hover:bg-indigo-700 shadow-lg">Â¡Comenzar Batalla!</button>
        </div>
    </div>

    <div id="turn-modal" class="fixed inset-0 flex items-center justify-center z-[70] hidden modal-overlay p-4">
        <div class="custom-modal p-8 rounded-3xl shadow-2xl text-center transform scale-100 animate-bounce-in border-4 border-indigo-500 w-full max-w-md mx-4">
            <p class="text-gray-500 uppercase text-xs font-bold mb-2">Turno de</p>
            <h2 id="turn-player-name" class="text-4xl font-bold mb-4 break-words leading-tight">Jugador 1</h2>
            <div class="text-6xl animate-pulse">ğŸ‘‡</div>
        </div>
    </div>

    <div id="records-modal" class="fixed inset-0 flex items-center justify-center z-[60] hidden modal-overlay p-4 fade-in">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl w-full max-w-md relative flex flex-col max-h-[85vh] gap-4">
            <button onclick="window.gameApp.closeRecordsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-700 p-2 z-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg></button>
            <div class="text-center mt-2"><span class="text-5xl mb-2 block">ğŸ†</span><h2 id="records-title" class="text-3xl font-bold text-indigo-700">RÃ©cords</h2><p id="records-subtitle" class="text-gray-400 text-sm">Top 5</p></div>
            <div id="records-list-view" class="space-y-3 overflow-y-auto flex-1 px-1 min-h-0"><div class="flex justify-center items-center h-full text-gray-400 py-8">Cargando rÃ©cords...</div></div>
            <button onclick="window.gameApp.closeRecordsModal()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shrink-0">Cerrar</button>
        </div>
    </div>

    <div id="exit-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal-overlay p-4 fade-in">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl text-center w-full max-w-sm transform scale-100 transition-all">
            <div class="text-5xl mb-4">ğŸ¤”</div><h2 class="text-2xl font-bold text-gray-800 mb-2">Â¿Volver al MenÃº?</h2><p class="text-gray-500 mb-6 text-sm px-4">Si sales ahora, se perderÃ¡ todo tu progreso.</p>
            <div class="grid grid-cols-2 gap-3"><button onclick="window.gameApp.closeExitModal()" class="bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition">Cancelar</button><button onclick="window.gameApp.exitToMenu()" class="bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600 shadow-lg transition">Salir</button></div>
        </div>
    </div>

    <div id="level-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal-overlay p-4">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl text-center w-full max-w-sm transform scale-100 animate-bounce-in">
            <div class="text-6xl mb-4">âœ¨</div><h2 class="text-2xl font-bold text-gray-800 mb-1">Â¡Nivel Superado!</h2><p class="text-gray-500 mb-2 text-sm">Nivel <span id="modal-level-num" class="font-bold text-indigo-600 text-lg">1</span> completado</p>
            <div id="level-summary-vs" class="hidden bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4"><p class="text-xs text-gray-500 uppercase font-bold mb-1">Ganador del Nivel</p><p id="level-winner-name" class="text-xl font-bold text-green-600">Jugador 1</p><p class="text-xs text-gray-400 mt-1">(MÃ¡s puntos o pares)</p></div>
            <button onclick="window.gameApp.nextLevel()" class="w-full bg-indigo-600 text-white py-3 rounded-2xl font-bold text-lg hover:bg-indigo-700 shadow-lg active:scale-95 transition flex items-center justify-center gap-2">Siguiente Nivel <span class="text-2xl">â¡ï¸</span></button>
        </div>
    </div>

    <div id="victory-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden modal-overlay p-4">
        <div class="custom-modal p-6 rounded-3xl shadow-2xl text-center w-full max-w-sm">
            <div class="text-6xl mb-2 animate-pulse">ğŸ†</div><h2 id="victory-title" class="text-3xl font-bold text-indigo-700 mb-1">Â¡GANASTE!</h2><p id="victory-subtitle" class="text-gray-500 mb-4 text-sm">Has completado los 10 niveles.</p>
            <div class="bg-indigo-50 p-4 rounded-xl mb-6 border border-indigo-100"><p id="final-stat-label" class="text-xs text-indigo-800 font-bold uppercase tracking-wide">Tiempo Total</p><p id="final-stat-value" class="text-4xl font-bold text-indigo-600 font-mono break-words">00:00</p></div>
            <div id="record-form" class="hidden mb-4"><div class="bg-green-50 p-3 rounded-lg border border-green-200 mb-3 animate-pulse"><p id="record-type-label" class="text-green-700 font-bold text-sm">Â¡TOP SCORE! ğŸ‰</p></div><div class="flex gap-2"><input type="text" id="player-name" placeholder="TU NOMBRE" maxlength="8" class="flex-1 bg-gray-50 border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-indigo-500 outline-none uppercase font-bold text-gray-700 text-center shadow-inner"><button onclick="window.gameApp.saveScore()" class="bg-green-500 text-white px-5 py-2 rounded-xl font-bold hover:bg-green-600 shadow-md">Guardar</button></div></div>
            <p id="no-record-msg" class="hidden text-sm text-gray-400 mb-4">Â¡Buen juego! Sigue intentando para entrar al ranking.</p>
            <div class="grid grid-cols-2 gap-3"><button id="btn-view-records" onclick="window.gameApp.openRecordsModal()" class="bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition">RÃ©cords</button><button onclick="window.gameApp.showMenu()" class="col-span-1 bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg transition w-full">MenÃº</button></div>
        </div>
    </div>

    <script type="module" src="funcionalidad.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('Service Worker registrado', reg)).catch(err => console.log('Error SW:', err));
            });
        }
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });
        installBtn.addEventListener('click', (e) => {
            installBtn.classList.add('hidden');
            deferredPrompt.prompt();
        });
    </script>
</body>
</html>